<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chosen Food</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css" />

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="generalFunctions.js"></script>

    <style>
        div  {
            border: 1px solid black;
        }
        
        .img-fluid {
            width: 100%;
            height: auto;
        }
        
        .imageContainer {
            margin-top: 4em;
            width: 450px !important
        }
        
        .mapclass {
            display: flex;
        }
        
        .mapinfo {
            width: fit-content;
        }
    </style>
</head>

<body class="overflow-y-hidden" onload="pageInit()">
    <style> 
        #foodhistory {
            height: 39em;
            overflow-y: auto;
        }    
    </style>
    <!-- Loading page -->
    <div id="loading">
        <header></header> 
        <img id="loading-image" src="./images/loading.gif" alt="Loading..." />
        <footer></footer>
    </div>

    <!-- Header -->
    <div class="logo" id="logo">
        <img src="./images/myfoodie.png" class="logoimage" />
        <div class="logotitle">
            <h4 style="color: white; font-family: Georgia, 'Times New Roman', Times, serif;">MyFoodie</h4>
        </div>
    </div>
    <div>
        <div class="container imageContainer" id="imageContainer" style="text-align: center;">
            <img src="./images/foodServe.PNG" class="img-fluid" width="80%" alt="..." />
        </div>

        <div class="container" id="foodhistory"></div>

        <script src="wikipediaApi.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        <div id='map' style='width: 400px; height: 300px;'></div>
    </div>    
    

    <script>
        function pageInit() {
            var foodName = window.location.search.split('?')[1].split('&')[0].split('=')[1]
            wiki(foodName).then(function() {
                updateImage();
                $("body").removeClass("overflow-y-hidden")
                hideElement('loading', 400);
            })
                        
        }
    </script> 



<<<<<<< HEAD
=======
    <div class="mapclass">
        <div id='map' style='width: 400px; height: 300px;'></div>
        <div id='mapinfo' class="mapinfo">
            <ul id="myList"></ul>
        </div>
    </div>
>>>>>>> last-touches

    <script>
        const lon = window.location.search.split("?")[1].split("&")[3].split("=")[1]
        const lat = window.location.search.split("?")[1].split("&")[2].split("=")[1]
        const tags = window.location.search.split("?")[1].split("&")[1].split("tags=")[1].replaceAll('+','&')
        const food = window.location.search.split("?")[1].split("&")[0].split("=")[1]

        console.log(tags)

        const query = `https://api.edamam.com/api/menu-items/v2/search?app_id=2ba0ec45&app_key=ac665ae3e41a33e09736700ec5a0c738&q=${food}&lat=${lat}&lon=${lon}${tags}`
        console.log(query)

        fetch(query).then(res => res.json()).then(data => {
            generateMap(data)
        })

        function updateImage() {
            $("#imageContainer" + " img").attr("src", window.location.search.split("?")[1].split("&")[4].split("=")[1]);
        }

        function generateMap(data) {
            const selectedPlaces = data['hints'].slice(0, 4)
            mapboxgl.accessToken = 'pk.eyJ1IjoidGRhY2F5YW4iLCJhIjoiY2tyMWY5b2h2MGdwMzJ3cnpjMXBoaXh4ciJ9.ZgutlFxWK6MQx7Mhz7Njfg';
            var map = new mapboxgl.Map({
                container: 'map', // container ID
                style: 'mapbox://styles/mapbox/streets-v11', // style URL
                center: [lon, lat], // starting position [lng, lat]
                zoom: 8 // starting zoom
            });
            new mapboxgl.Marker({
                    color: "red",
                    draggable: true
                }).setLngLat([lon, lat])
                .addTo(map);
            let color = ['green', 'blue', 'yellow', 'pink']
            return selectedPlaces.map((element, index) => {
                if (element.food.restaurant.location) {
                    outPutMapData(element, color[index])
                    return new mapboxgl.Marker({
                            color: color[index],
                            draggable: true
                        }).setLngLat([element.food.restaurant.location.lon, element.food.restaurant.location.lat])
                        .addTo(map);
                }
            });
        }

        function outPutMapData(data, color) {
            var node = document.createElement("li");
            var textnode = document.createTextNode('Restaurant name: ' +
                data.food.restaurant.address + ' | ' +
                'Address: ' +
                data.food.restaurant.postal);
            node.appendChild(textnode);
            node.style.color = color
            document.getElementById("myList").appendChild(node);
        }
    </script>

</body>

</html>